#include <mpi.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

static void strip_newline(char *s) {
    if (!s) return;
    size_t n = strlen(s);
    if (n > 0 && s[n - 1] == '\n') s[n - 1] = '\0';
}

int main(int argc, char **argv) {
    MPI_Init(&argc, &argv);

    int rank, size;
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);
    MPI_Comm_size(MPI_COMM_WORLD, &size);

    char *word = NULL;
    int N = 0;              
    int buf_len = 0;        

    if (rank == 0) {
        
        char tmp[100000]; 
        printf("Δώσε μία λέξη: ");
        fflush(stdout);

        if (!fgets(tmp, sizeof(tmp), stdin)) {
            fprintf(stderr, "Σφάλμα ανάγνωσης.\n");
            tmp[0] = '\0';
        }
        strip_newline(tmp);

        N = (int)strlen(tmp);
        buf_len = N + 1;

        word = (char *)malloc((size_t)buf_len);
        if (!word) {
            fprintf(stderr, "Αποτυχία malloc.\n");
            MPI_Abort(MPI_COMM_WORLD, 1);
        }
        memcpy(word, tmp, (size_t)buf_len);
    }

    
    MPI_Bcast(&N, 1, MPI_INT, 0, MPI_COMM_WORLD);
    buf_len = N + 1;

    
    if (rank != 0) {
        word = (char *)malloc((size_t)buf_len);
        if (!word) {
            fprintf(stderr, "Rank %d: Αποτυχία malloc.\n", rank);
            MPI_Abort(MPI_COMM_WORLD, 1);
        }
    }
    MPI_Bcast(word, buf_len, MPI_CHAR, 0, MPI_COMM_WORLD);

    
    
    int total_pairs = N / 2;

    
    int start = (rank * total_pairs) / size;
    int end   = ((rank + 1) * total_pairs) / size;

    int local_ok = 1;
    for (int i = start; i < end; i++) {
        if (word[i] != word[N - 1 - i]) {
            local_ok = 0;
            break;
        }
    }

    int global_ok = 0;
    
    MPI_Reduce(&local_ok, &global_ok, 1, MPI_INT, MPI_LAND, 0, MPI_COMM_WORLD);

    if (rank == 0) {
        if (global_ok) printf("yes\n");
        else           printf("no\n");
    }

    free(word);
    MPI_Finalize();
    return 0;
}
